% we assume the destination is reachable
maxTime(40).
cycleInterval(200).

loadModule('../scripts/module.js').

fluents([
   coordinate(X, Y),
   location(VehicleName, coordinate(X, Y), Direction),
   trafficLight(coordinate(X, Y), Working_status, Color, FacingDirection),
   street(StreetName, coordinate(X, Y), Width, Height, Number_of_lane),
   goal(VehicleName,coordinate(X, Y)),
   % define the junction coordinate
   junction(Name,coordinate(A, B),coordinate(C, D),coordinate(E, F),coordinate(G, H))
]).

% events will reserved for traffic lights
events ([

]).

actions ([
  step(Vehicle, NextPlace),
  turn(Vehicle, NewHeading)
]).

initially([
  location(carA, coordinate(120, 225), eastward),
  goal(carA,coordinate(400, 225)),
  street(mainStreet , coordinate(100, 200), 900, 50, 1),
  street(southStreet , coordinate(475, 250), 50, 500, 1),
  junction(tJuntion,coordinate(475, 200),coordinate(525, 200),coordinate(475, 250),coordinate(525, 250))
]).

goal(Vehicle,coordinate(A, B)) from _ to T,
location(VehicleName, coordinate(X, Y), Direction), A!=X at T ->
  % need to find the right direction here
  % driving forward
    drive(Vehicle) from T to _.

goal(Vehicle,coordinate(A, B)) from _ to T,
location(VehicleName, coordinate(X, Y), Direction), B!=Y at T ->
  % need to find the right direction here
  % driving forward
    drive(Vehicle) from T to _.

drive(Vehicle) from T to T1 <-
  location(Vehicle, coordinate(X, Y), Direction),
  Direction == northward,
  NewY = Y - 10,
  NextPlace = coordinate(X, NewY),
  step(Vehicle, NextPlace) from T1 to T2.

drive(Vehicle) from T to T1 <-
  location(Vehicle, coordinate(X, Y), Direction),
  Direction == southward,
  NewY = Y + 10,
  NextPlace = coordinate(X, NewY),
  step(Vehicle, NextPlace) from T1 to T2.

drive(Vehicle) from T to T1 <-
  location(Vehicle, coordinate(X, Y), Direction),
  Direction == westward,
  NewX = X-10,
  NextPlace = coordinate(NewX, Y),
  step(Vehicle, NextPlace) from T1 to T2.

drive(Vehicle) from T to T1 <-
  location(Vehicle, coordinate(X, Y), Direction),
  Direction == eastward,
  NewX = X + 10,
  NextPlace = coordinate(NewX, Y),
  step(Vehicle, NextPlace) from T1 to T2.

% step is false if the car is moving into a junction, not on main Road and there is a collision.
<- step(Vehicle, NextPlace), onTjunction(coordinate(X, NewY)), not onMainRoad(Vehicle),collisionPossible(Vehicle1, Vehicle2).

collisionPossible(Vehicle1, Vehicle2) at T <-
  location(Vehicle1, Place1, Heading1) at T,
  next(Place1, Heading1, Place2),
  location(Vehicle2, Place2, Heading2) at T,
  not opposite(Heading1, Heading2).

updates(step(Vehicle, NextPlace), location(VehicleName, OldPlace, Direction),  location(Vehicle, NextPlace, Direction)).

updates(turn(Vehicle, NewHeading) , location(Vehicle, Place, OldHeading), location(Vehicle, Place, NewHeading)).


% you  can not move (x++) if you are not facing eastward
